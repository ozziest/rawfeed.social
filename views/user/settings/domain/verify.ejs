<div class="max-w-2xl mx-auto px-4 py-8">
  <!-- Header -->
  <div class="mb-6">
    <a
      href="/user/settings"
      class="text-blue-600 hover:text-blue-700 text-sm font-medium mb-3 inline-block"
    >
      ← Back to Settings
    </a>
    <h1 class="text-2xl font-bold text-gray-900 mb-2">Verify Custom Domain</h1>
    <p class="text-gray-600">
      Follow the steps below to verify ownership of your domain.
    </p>
  </div>

  <!-- Domain Info -->
  <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
    <div class="flex items-center justify-between mb-4">
      <div>
        <p class="text-sm text-gray-600 mb-1">Your Domain</p>
        <p class="text-xl font-semibold text-gray-900">
          <%= user.custom_domain %>
        </p>
      </div>
      <% if (user.domain_verification_status === 'pending') { %>
      <span
        class="px-3 py-1 text-sm font-medium text-amber-700 bg-amber-100 rounded-full"
      >
        Pending Verification
      </span>
      <% } else if (user.domain_verification_status === 'verified') { %>
      <span
        class="px-3 py-1 text-sm font-medium text-green-700 bg-green-100 rounded-full"
      >
        ✓ Verified
      </span>
      <% } else if (user.domain_verification_status === 'failed') { %>
      <span
        class="px-3 py-1 text-sm font-medium text-red-700 bg-red-100 rounded-full"
      >
        Verification Failed
      </span>
      <% } %>
    </div>
  </div>

  <% if (user.domain_verification_status !== 'verified') { %>
  <!-- Step 1: Add DNS TXT Record -->
  <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
    <div class="flex items-start gap-3 mb-4">
      <span
        class="shrink-0 w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center font-semibold"
        >1</span
      >
      <div class="flex-1">
        <h2 class="text-lg font-semibold text-gray-900 mb-2">
          Add DNS TXT Record
        </h2>
        <p class="text-gray-600 mb-4">
          Log in to your domain provider's control panel and add the following
          TXT record:
        </p>

        <!-- DNS Record Box -->
        <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 space-y-3">
          <div>
            <p class="text-xs font-medium text-gray-500 uppercase mb-1">Type</p>
            <div class="flex items-center gap-2">
              <code class="text-sm font-mono text-gray-900">TXT</code>
            </div>
          </div>

          <div>
            <p class="text-xs font-medium text-gray-500 uppercase mb-1">Name</p>
            <div class="flex items-center gap-2">
              <code class="text-sm font-mono text-gray-900 break-all"
                >_rawfeed.<%= user.custom_domain %></code
              >
              <button
                data-copy="_rawfeed.<%= user.custom_domain %>"
                class="text-blue-600 hover:text-blue-700 text-sm"
                title="Copy to clipboard"
              >
                <svg
                  class="w-4 h-4"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"
                  />
                </svg>
              </button>
            </div>
            <p class="text-xs text-gray-500 mt-1">
              Some DNS providers may only require
              <code class="font-mono">_rawfeed</code>
            </p>
          </div>
          <div>
            <p class="text-xs font-medium text-gray-500 uppercase mb-1">
              Value
            </p>
            <div class="flex items-center gap-2">
              <code class="text-sm font-mono text-gray-900 break-all"
                ><%= user.domain_verification_token %></code
              >
              <button
                data-copy="<%= user.domain_verification_token %>"
                class="text-blue-600 hover:text-blue-700 text-sm"
                title="Copy to clipboard"
              >
                <svg
                  class="w-4 h-4"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"
                  />
                </svg>
              </button>
            </div>
          </div>

          <div>
            <p class="text-xs font-medium text-gray-500 uppercase mb-1">TTL</p>
            <code class="text-sm font-mono text-gray-900">3600</code>
            <span class="text-xs text-gray-500 ml-2">(or default)</span>
          </div>
        </div>

        <div class="mt-4 bg-amber-50 border border-amber-200 rounded-lg p-3">
          <p class="text-sm text-amber-800">
            <strong>Note:</strong> DNS changes can take 5-10 minutes to
            propagate. Some providers may take up to 48 hours.
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Step 2: Verify -->
  <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
    <div class="flex items-start gap-3">
      <span
        class="shrink-0 w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center font-semibold"
        >2</span
      >
      <div class="flex-1">
        <h2 class="text-lg font-semibold text-gray-900 mb-2">Verify Domain</h2>
        <p class="text-gray-600 mb-4">
          After adding the DNS record, click the button below to verify your
          domain.
        </p>

        <form method="POST" action="/user/settings/domain/verify">
          <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
          <button
            type="submit"
            class="bg-blue-600 hover:bg-blue-700 text-white font-medium px-6 py-3 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
          >
            Verify Domain
          </button>
        </form>

        <% if (user.domain_verification_status === 'failed') { %>
        <div class="mt-4 bg-red-50 border border-red-200 rounded-lg p-3">
          <p class="text-sm text-red-800">
            <strong>Verification failed.</strong> Please make sure you've added
            the DNS TXT record correctly and wait a few minutes for DNS
            propagation.
          </p>
        </div>
        <% } %>
      </div>
    </div>
  </div>
  <% } else { %>
  <!-- Domain Verified - Step 3: CNAME Setup -->
  <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
    <div class="flex items-start gap-3 mb-4">
      <span
        class="shrink-0 w-8 h-8 bg-green-100 text-green-600 rounded-full flex items-center justify-center font-semibold"
        >✓</span
      >
      <div class="flex-1">
        <h2 class="text-lg font-semibold text-gray-900 mb-2">
          Domain Verified!
        </h2>
        <p class="text-gray-600 mb-4">
          Your domain has been verified. Now add a CNAME record to point your
          domain to rawfeed.social:
        </p>

        <!-- CNAME Record Box -->
        <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 space-y-3">
          <div>
            <p class="text-xs font-medium text-gray-500 uppercase mb-1">Type</p>
            <code class="text-sm font-mono text-gray-900">CNAME</code>
          </div>

          <div>
            <p class="text-xs font-medium text-gray-500 uppercase mb-1">Name</p>
            <div class="flex items-center gap-2">
              <code class="text-sm font-mono text-gray-900"
                ><%= user.custom_domain %></code
              >
              <button
                data-copy="<%= user.custom_domain %>"
                class="text-blue-600 hover:text-blue-700 text-sm"
                title="Copy to clipboard"
              >
                <svg
                  class="w-4 h-4"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"
                  />
                </svg>
              </button>
            </div>
            <p class="text-xs text-gray-500 mt-1">
              Some DNS providers may only require the subdomain part
            </p>
          </div>

          <div>
            <p class="text-xs font-medium text-gray-500 uppercase mb-1">
              Value
            </p>
            <div class="flex items-center gap-2">
              <code class="text-sm font-mono text-gray-900"
                ><%= user.username %>.rawfeed.social</code
              >
              <button
                data-copy="rawfeed.social"
                class="text-blue-600 hover:text-blue-700 text-sm"
                title="Copy to clipboard"
              >
                <svg
                  class="w-4 h-4"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"
                  />
                </svg>
              </button>
            </div>
          </div>
        </div>

        <div class="mt-4 bg-green-50 border border-green-200 rounded-lg p-3">
          <p class="text-sm text-green-800">
            <strong>Success!</strong> Once the CNAME record is added, your
            profile will be accessible at
            <strong><%= user.custom_domain %></strong>
          </p>
        </div>
      </div>
    </div>
  </div>
  <% } %>

  <!-- Cancel / Remove Domain -->
  <div class="bg-white rounded-lg shadow-sm p-6">
    <h3 class="font-semibold text-gray-900 mb-2">Remove Custom Domain</h3>
    <p class="text-gray-600 text-sm mb-4">
      This will remove your custom domain and you'll need to set it up again
      from scratch.
    </p>
    <a
      href="/user/settings/domain/remove"
      class="text-red-600 hover:text-red-700 font-medium text-sm cursor-pointer"
    >
      Remove Domain
    </a>
  </div>
</div>

<script src="/public/js/copy-to-clipboard.js"></script>
